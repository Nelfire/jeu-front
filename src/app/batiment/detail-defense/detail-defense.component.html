<!-- Affichage mode construction -->
<div *ngIf="defense && joueur">


    <div class="grid-container">
        <div class="defense card">
            <!-- ICONE -->
            <img src="{{defense['icone']}}" class="card__image">
            <p class="card__name">{{defense['libelle']}}</p>

            <p class="card__quantitee_possession" *ngIf="quantiteeDefensesPossession >=1">
                <input disabled type="text" class="quantitePossede" value="Possède : {{quantiteeDefensesPossession}}" />
            </p>

            <!-- DESCRIPTION -->
            <p class="card__description">
                {{defense['descriptif']}}
            </p>

            <!-- STATISTIQUES  -->
            <!-- VIE -->
            <div class="row">
                <div class="col-sm-6">
                    <p class="card__statistique">
                        Vie : {{defense['vie']}}
                    </p>
                </div>
                <div class="col-sm-6">
                    <p class="card__statistique">
                        Attaque : {{defense['attaque']}}
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <p class="card__statistique">
                        Bouclier : {{defense['bouclier']}}
                    </p>
                </div>
                <div class="col-sm-6">
                    <p class="card__statistique">
                    </p>
                </div>
            </div>

            <!-- ATTAQUE -->
            <!-- TEMPS DE CONSTRUCTION -->
            <p class="card__temps__travail">
                Temps de construction : {{defense['tempsConstruction'] | minuteSecondePipe: 's':'hhmmss'}}
            </p>

            <!-- COUT -->
            <div class="row">
                <div class="col-sm-12">
                    <p class="card__categorie">
                        Coût
                    </p>
                </div>
            </div>
            <!-- PIERRE -->
            <div class="row">
                <div class="col-sm-6">
                    <p class="card__cout__ressource">
                        Pierre :
                        <span [ngStyle]="{color:getColorRessourceManquantePierre()}">
                            <b>{{coutPierreConstruction}}</b>
                        </span>
                    </p>
                </div>
                <!-- BOIS -->
                <div class="col-sm-6">
                    <p class="card__cout__ressource">
                        Bois :
                        <span [ngStyle]="{color:getColorRessourceManquanteBois()}">
                            <b>{{coutBoisConstruction}}</b>
                        </span>
                    </p>
                </div>
            </div>
            <!-- OR -->
            <div class="row">
                <div class="col-sm-6">
                    <p class="card__cout__ressource">
                        Or :
                        <span [ngStyle]="{color:getColorRessourceManquanteOr()}">
                            <b>{{coutOrConstruction}}</b>
                        </span>
                    </p>
                </div>
                <!-- NOURRITURE -->
                <div class="col-sm-6">
                    <p class="card__cout__ressource">
                        Nourriture :
                        <span [ngStyle]="{color:getColorRessourceManquanteNourriture()}">
                            <b>{{coutNourritureConstruction}}</b>
                        </span>
                    </p>
                </div>
            </div>

            <!-- Si le joueur possède le bâtiment -->
            <span *ngIf="joueurPossedeBatiment; else possedePas">
                <!-- Si le niveau du bâtiment est assez élevé -->
                <span *ngIf="niveauBatimentAssezEleveConstruction; else niveauBatimentPasAssezEleve">
                    <!-- Si le bâtiment n'est pas occupé [Construction/Amélioration]-->
                    <span *ngIf="!batimentEnCoursDeTravail; else batimentOccupe">
                        <div>
                            <form [formGroup]="formCreationDefense" (ngSubmit)="construireDefense()">
                                <div class="divformulaireCreation">
                                    <!-- Choix quantité -->
                                    <input type="text" pattern="[0-9]*" class="form-control" class="quantite"
                                        id="quantite" rows="3" formControlName="quantite" [(ngModel)]="quantite"
                                        (keyup)="recalculPrix(quantite)" required />
                                    <button type="button" class="btn draw-border" (click)="maximum()">Maximum</button>
                                </div>
                                <!-- Désactivation du bouton si quantitée incorrecte ou vide -->

                                <!-- Quantité maximale -->

                                <div class="row">
                                    <div class="col-sm-6">
                                        <button class="btn draw-border"
                                            [disabled]="formCreationDefense.invalid || quantite==0">
                                            Construire
                                        </button>
                                    </div>
                                    <div class="col-sm-6">
                                        <button routerLink="../../../defense" class="btn draw-border-error">
                                            Retour
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </span>
                </span>
            </span>

            <!-- Niveau du bâtiment pas assez élevé pour produire l'unitée -->
            <ng-template #niveauBatimentPasAssezEleve>
                <div class="row">
                    <div class="col-sm-6">
                        <a routerLink="../../../batiment/detail-batiment/{{defense.idBatimentProvenance}}">
                            <button class="btn draw-border-error">Niveau bâtiment insufisant</button>
                        </a>
                    </div>
                    <div class="col-sm-6">
                        <button routerLink="../../../armee" class="btn draw-border-error">
                            Retour
                        </button>
                    </div>
                </div>
            </ng-template>

            <!-- Le joueur ne possède pas encore le bâtiment -->
            <ng-template #possedePas>
                <div class="row">
                    <div class="col-sm-6">
                        <a routerLink="../../../batiment/detail-batiment/{{defense.idBatimentProvenance}}">
                            <button class="btn draw-border-error">Bâtiment manquant</button></a>
                    </div>
                    <div class="col-sm-6">
                        <button routerLink="../../../armee" class="btn draw-border-error">
                            Retour
                        </button>
                    </div>
                </div>
            </ng-template>

            <!-- Bâtiment en cours de construction / d'amélioration -->
            <ng-template #batimentOccupe>
                <div class="row">
                    <div class="col-sm-6">
                        <a routerLink="../../../batiment/detail-batiment/{{defense.idBatimentProvenance}}">
                            <button class="btn draw-border-error">Bâtiment en cours de travail</button>
                        </a>
                    </div>
                    <div class="col-sm-6">
                        <button routerLink="../../../armee" class="btn draw-border-error">
                            Retour
                        </button>
                    </div>
                </div>

            </ng-template>

            <!-- MESSAGES D'INFORMATION -->
            <!-- ERREUR-->
            <div class="alert alert-danger divCenter mt-3" style="text-align: center;" role="danger"
                *ngIf="messageErreur">
                <b>{{messageErreur}}</b>
            </div>
            <!-- OK-->
            <div class="alert alert-success divCenter mt-3" role="success" *ngIf="messageValidation">
                <b>{{messageValidation}}</b>
            </div>
        </div>
        <div class="production-en-cours card" *ngIf="secondesRestantesAmelioration">

            <div class="mt-3">
                <hr class="style-seven">
                
                <p class="card__description center"><u>Constructions en cours</u></p>

                <p class="card__progress_bar_text">Temps restant : {{secondesRestantesAmelioration | minuteSecondePipe: 's':'hhmmss'}}</p>
                <div class="progress mb-3 center" style="width: 80%;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                        [ngStyle]="{width:getTempsConstructionTotalFileAttentePourcent()}"></div>
                </div>

                <p class="card__description center mb-3"><u>Défenses restantes : {{defensesRestantesArrondis}}</u></p>
                

                <div class="progress mb-3 center" style="width: 80%;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                        [ngStyle]="{width:getTempsConstructionDefensePourcent()}"></div>
                </div>
                <hr class="style-seven">
            </div>
        </div>
    </div>


</div>